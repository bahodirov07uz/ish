{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/employee_detail.css' %}">
<div class="app">
    <div class="main-content">
       
        <main class="content">
            <div class="page">
                <div class="page-header">
                    <div class="breadcrumb">
                        <a href="/">Bosh sahifa</a>
                        <span>/</span>
                        <a href="{% url 'main:employee' %}">Ishchilar</a>
                        <span>/</span>
                        <span>{{ ishchi.ism }} {{ ishchi.familiya }}</span>
                    </div>
                </div>

                <div class="worker-grid">
                    <div class="worker-info-card">
                        
                        <h3 class="worker-name">{{ ishchi.ism }} {{ ishchi.familiya }}</h3>
                        <p class="worker-type">{{ ishchi.turi.nomi }}</p>

                        <div class="worker-details">
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M2 5c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2v6c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V5z" />
                                        <path d="M2 5l6 4 6-4" />
                                    </svg>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Telefon raqami</div>
                                    <div class="detail-value">{{ ishchi.telefon }}</div>
                                </div>
                            </div>

                            <div class="detail-item">
                                <div class="detail-icon">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <rect x="2" y="3" width="12" height="10" rx="1" />
                                        <path d="M2 7h12" />
                                    </svg>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Lavozim</div>
                                    <div class="detail-value">{{ ishchi.turi.nomi }}</div>
                                </div>
                            </div>

                            <div class="detail-item">
                                <div class="detail-icon">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <rect x="3" y="4" width="10" height="9" rx="1" />
                                        <path d="M3 7h10M6 4v3M10 4v3" />
                                    </svg>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Holati</div>
                                    <div class="detail-value">
                                        {% if ishchi.is_oylik_open %}
                                        <span style="color: var(--color-success)">Faol</span>
                                        {% else %}
                                        <span style="color: var(--text-secondary)">Yopilgan</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="salary-card">
                            <div class="salary-label">Joriy oylik</div>
                            <div class="salary-amount">{{ ishchi.umumiy_oylik|intcomma }} so'm</div>

                            <div class="salary-actions">
                                {% if ishchi.is_oylik_open %}
                                <form method="post" action="{% url 'main:oylik_yopish' ishchi.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-success">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M3 8l3 3 7-7" />
                                        </svg>
                                        Oylikni yopish
                                    </button>
                                </form>
                                {% else %}
                                <form method="post" action="{% url 'main:yangi_oy' ishchi.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-primary">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M8 3v10M3 8h10" />
                                        </svg>
                                        Yangi oyni boshlash
                                    </button>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="work-history-card">
                        <div class="card-header">
                            <h3>Bu oydagi ishlar</h3>
                            <span class="badge">{{ object.ishlar.count }} ta ish obyekti topildi</span>
                        </div>

                        {% if ishlar %}
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Mahsulot</th>
                                        <th>Soni</th>
                                        <th>Narxi</th>
                                        <th>Sana</th>
                                        <th>Jami</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for ish in ishlar %}
                                    <tr>
                                        <td>{{ ish.mahsulot.nomi }}</td>
                                        <td>{{ ish.soni }}</td>
                                        <td>{{ ish.narxi|intcomma }} so'm</td>
                                        <td>{{ ish.sana|date:"d.m.Y" }}</td>
                                        <td><strong>{{ ish.narxi|intcomma }} so'm</strong></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M9 11l3 3L22 4" />
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                                </svg>
                            </div>
                            <h4 class="empty-title">Hali ishlar yo'q</h4>
                            <p class="empty-description">Bu oyda hali birorta ish ro'yxatga olinmagan</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </main>
        <div style="width: 35%; padding: 10px;justify-content: center; margin-left: 5%; margin-bottom: 50px;" class="work-history-card ">
            <div class="" style="margin-bottom: 2px;">
                <h3 style="margin-bottom: 15px;">Joriy oy bo‘yicha umumiy mahsulotlar {{ish_soni.total}} ta</h3>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Mahsulot</th>
                            <th>Soni</th>
                            <th>Summa</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in oy_stat %}
                        <tr>
                            <td>{{ item.mahsulot__nomi }}</td>
                            <td>{{ item.jami_soni }}</td>
                            <td>{{ item.jami_summa }} so'm</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3">Bu oyda ish yo‘q</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
<div style="width: 35%; padding: 10px; justify-content: center; margin-left: 5%; margin-bottom: 50px;" class="work-history-card">
    <div style="margin-bottom: 2px;">
        <h3 style="margin-bottom: 15px;">Ishchi avanslari {{total_avans}} beriladi {{beriladi}}</h3>

        <table class="table">
            <thead>
                <tr>
                    <th>Summa</th>
                    <th>Berilgan sana</th>
                    <th>Status</th>
                    <th>Yopilgan sana</th>
                </tr>
            </thead>
            <tbody>
                {% for avans in avanslar %}
                <tr>
                    <td>{{ avans.amount }} so'm</td>
                    <td>{{ avans.created|date:"d.m.Y" }}</td>
                    <td>
                        {% if avans.is_active %}
                            <span style="color: green;">Faol</span>
                        {% else %}
                            <span style="color: gray;">Yopilgan</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if avans.ended %}
                            {{ avans.ended|date:"d.m.Y" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">Avanslar yo'q</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

    </div>
</div>
{% endblock content %}