{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/product_list.css' %}">
<link rel="stylesheet" href="{% static 'css/product_card_update.css' %}">
    <div class="app">

        <div class="main-content">
            <header class="header">
                <button class="menu-toggle" id="menuToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                </button>
                <div class="header-title">Mahsulotlar</div>
                <button class="theme-toggle-mobile" id="themeToggleMobile">
                    <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="10" cy="10" r="4"/>
                        <path d="M10 1v2m0 14v2M19 10h-2M3 10H1m15.07-6.07l-1.41 1.41M5.34 14.66l-1.41 1.41m12.14 0l-1.41-1.41M5.34 5.34L3.93 3.93"/>
                    </svg>
                    <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 10.5A7 7 0 1 1 9.5 3a5.5 5.5 0 0 0 7.5 7.5z"/>
                    </svg>
                </button>
            </header>

            <main class="content">
                <div class="page">
                    <div class="page-header">
                        <div>
                            <h2>Mahsulotlar</h2>
                            <p>Barcha mahsulotlarni ko'ring va boshqaring</p>
                        </div>
                        <button class="btn btn-primary" id="addProductBtn">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 5v10M5 10h10"/>
                            </svg>
                            <span>Yangi mahsulot</span>
                        </button>
                    </div>
                    
                    <div class="search-bar">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="9" r="6"/>
                            <path d="M13 13l4 4"/>
                        </svg>
                        <input type="text" id="productSearch" placeholder="Mahsulotlarni qidirish...">
                    </div>
                    
                    <div id="productsGrid" class="items-grid">
                        {% if products %}
                            {% for product in products %}
                                <div class="item-card">
                                    <div class="item-card-header">
                                        <img src="{{ product.image.url }}" alt="{{ product.nomi }}">
                                    </div>
                                    <div class="item-card-body">
                                        <div class="item-subtitle">{{ product.category }}</div>
                                        <h3 class="item-title">{{ product.nomi }}</h3>
                                        
                                        <div class="item-price">
                                            <span class="item-price-label">Narxi:</span>
                                            {{ product.narxi|floatformat:0 }} so'm
                                        </div>
                                        
                                        <div class="item-quantity">
                                            Miqdori: 
                                            <span class="item-quantity-value">{{ product.total_stock }} ta</span>
                                        </div>
                                        
                                        {% if product.description %}
                                        <p class="item-description">{{ product.description }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-products">
                                <p>Hozircha mahsulotlar mavjud emas.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Yangi mahsulot</h3>
                <button class="modal-close" id="closeProductModal">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 5l10 10M15 5l-10 10"/>
                    </svg>
                </button>
            </div>
            <form id="productForm" method="POST" action="" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label>Nomi</label>
                    <input type="text" id="productName" name="name" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Narxi (so'm)</label>
                        <input type="number" id="productPrice" name="price" required>
                    </div>
                    <div class="form-group">
                        <label>Miqdori</label>
                        <input type="number" id="productQuantity" name="quantity" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Kategoriya</label>
                    <input type="text" id="productCategory" name="category">
                </div>
                <div class="form-group">
                    <label>Rasm</label>
                    <input type="file" id="productImage" name="image" accept="image/*">
                </div>
                <div class="form-group">
                    <label>Tavsif</label>
                    <textarea id="productDescription" name="description" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelProductBtn">Bekor qilish</button>
                    <button type="submit" class="btn btn-primary">Saqlash</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Mahsulotlar modalini boshqarish
        const addProductBtn = document.getElementById('addProductBtn');
        const productModal = document.getElementById('productModal');
        const closeProductModal = document.getElementById('closeProductModal');
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        const productForm = document.getElementById('productForm');
        
        addProductBtn.addEventListener('click', () => {
            productModal.classList.add('active');
        });
        
        closeProductModal.addEventListener('click', () => {
            productModal.classList.remove('active');
        });
        
        cancelProductBtn.addEventListener('click', () => {
            productModal.classList.remove('active');
        });
        
        // Qidiruv funksiyasi
        const productSearch = document.getElementById('productSearch');
        productSearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const productCards = document.querySelectorAll('.item-card');
            
            productCards.forEach(card => {
                const productName = card.querySelector('.item-title').textContent.toLowerCase();
                const productCategory = card.querySelector('.item-subtitle').textContent.toLowerCase();
                
                if (productName.includes(searchTerm) || productCategory.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    </script>
{% endblock content %}